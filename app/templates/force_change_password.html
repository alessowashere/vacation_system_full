{% extends "base_auth.html" %}

{% block title %}Cambiar Contraseña{% endblock %}

{% block content %}
  <h2 class="text-xl font-semibold mb-4 text-center text-gray-700">Cambio de Contraseña</h2>

  <div class="text-center bg-yellow-50 border border-yellow-300 text-yellow-800 p-4 mb-6 rounded-md text-sm">
    <p>Por seguridad, <strong>{{ user.username }}</strong>, debes establecer una nueva contraseña para continuar.</p>
  </div>

  {% if error_msg %}
  <div class="mb-4 p-4 bg-red-100 border border-red-400 text-red-700 rounded-lg" role="alert">
    <span class="font-medium">{{ error_msg }}</span>
  </div>
  {% endif %}

  <form action="{{ url_for('change_password_submit') }}" method="post">
    <div class="mb-4">
      <label for="new_password" class="block text-sm font-medium text-gray-700">Nueva Contraseña:</label>
      <div class="relative mt-1">
        <span class="absolute inset-y-0 left-0 flex items-center pl-3">
          <svg class="h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M10 1a4.5 4.5 0 00-4.5 4.5V9H5a2 2 0 00-2 2v6a2 2 0 002 2h10a2 2 0 002-2v-6a2 2 0 00-2-2h-.5V5.5A4.5 4.5 0 0010 1zm3 8V5.5a3 3 0 10-6 0V9h6z" clip-rule="evenodd" />
          </svg>
        </span>
        <input type="password" name="new_password" id="new_password" required 
               class="block w-full pl-10 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
      </div>
      <ul class="text-xs text-gray-500 mt-2 list-disc pl-5 space-y-1">
        <li>Mínimo 8 caracteres</li>
        <li>Debe incluir una mayúscula (A-Z)</li>
        <li>Debe incluir un número (0-9)</li>
        <li>Debe incluir un carácter especial (!@#$)</li>
      </ul>
    </div>
    
    <div class="mb-6">
      <label for="confirm_password" class="block text-sm font-medium text-gray-700">Confirmar Nueva Contraseña:</label>
      <div class="relative mt-1">
        <span class="absolute inset-y-0 left-0 flex items-center pl-3">
          <svg class="h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M10 1.944c-4.29 0-7.788 3.39-7.983 7.682-.127 2.74.873 5.3 2.68 7.23l.18.19 1.12-1.12.18-.18a5.96 5.96 0 01-1.87-4.119C4.305 7.603 6.84 5.056 10 5.056c3.16 0 5.695 2.547 5.878 6.04.12 2.376-.71 4.59-2.22 6.162l.18.18 1.12 1.12.18-.19a8.003 8.003 0 002.68-7.23C17.788 5.333 14.29 1.944 10 1.944z" clip-rule="evenodd" />
            <path d="M10 18a.75.75 0 00.75-.75V9.736a.75.75 0 10-1.5 0v7.514A.75.75 0 0010 18z" />
          </svg>
        </span>
        <input type="password" name="confirm_password" id="confirm_password" required
               class="block w-full pl-10 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
      </div>
    </div>
    
    <button type="submit" 
            class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700">
      Establecer Contraseña y Continuar
    </button>
  </form>

  <div class="text-center mt-6">
    <a href="{{ url_for('logout') }}" class="text-sm text-gray-500 hover:text-red-600">
      Salir
    </a>
  </div>
{% endblock %}