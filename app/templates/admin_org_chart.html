{% extends "base.html" %}

{% block title %}Organigrama{% endblock %}

{% block content %}
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">
  google.charts.load('current', {packages:["orgchart"]});
  google.charts.setOnLoadCallback(drawChart);

  function drawChart() {
    var data = new google.visualization.DataTable();
    data.addColumn('string', 'Name');
    data.addColumn('string', 'Manager');
    data.addColumn('string', 'ToolTip');

    // Insertar datos desde Python (Jinja2 renderizar치 esto como una lista JS v치lida)
    var chartData = {{ org_data|tojson }};
    
    // Convertir los diccionarios de vuelta a objetos JS si es necesario, 
    // pero tojson suele manejarlo bien. Google espera filas.
    data.addRows(chartData);

    var chart = new google.visualization.OrgChart(document.getElementById('chart_div'));
    
    // Opciones de dise침o
    chart.draw(data, {'allowHtml':true, 'size': 'medium', 'nodeClass': 'org-node'});
  }
</script>

<style>
  /* Estilo suave para los nodos */
  .org-node {
      background: #fff;
      border: 1px solid #ccc;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  }
  /* Quitar el azul de selecci칩n por defecto de Google */
  .google-visualization-orgchart-node-medium {
      border: none;
  }
</style>

<div class="flex justify-between items-center mb-6">
  <h1 class="text-2xl font-bold">Organigrama Institucional</h1>
  <a href="{{ url_for('admin_user_list') }}" class="text-blue-500 hover:underline">&larr; Volver a Lista</a>
</div>

<div class="overflow-x-auto bg-gray-50 p-8 rounded-lg border border-gray-200">
  <div id="chart_div"></div>
</div>
{% endblock %}